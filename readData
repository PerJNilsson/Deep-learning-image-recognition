
import csv
from PIL import Image
from numpy import array
from numpy import asarray

def readData(path, classRange):

    images = []
    arr = []
    labels = []
    i = 1
    for c in range(0, classRange):
        prefix = path + '/' + format(c, '05d') + '/'  # subdirectory for class
        gtFile = open(prefix + 'GT-' + format(c, '05d') + '.csv')  # annotations file
        gtReader = csv.reader(gtFile, delimiter=';')  # csv parser for annotations file
        next(gtReader)  # skip header
        # loop over all images in current annotations file

        for row in gtReader:
            if i % 100 == 0:
                print('Class: ', c, 'Image', i)
            im = Image.open(prefix + row[0])
            images.append(im.crop((int(row[3]), int(row[4]), int(row[5]), int(row[6]))).resize((32, 32)))
            labels.append(int(row[7]))  # the 8th column is the label
            arr.append(array(images[-1]))
            i = i+1
        gtFile.close()
    return arr, labels, images


def readValidationData(path):

    images = []
    arr = []
    labels = []
    i = 1

    prefix = path + '/'
    gtFile = open(prefix + 'GT-final_test_with_classes.csv')  # annotations file
    gtReader = csv.reader(gtFile, delimiter=';')  # csv parser for annotations file
    next(gtReader)  # skip header

    for row in gtReader:
        if i % 100 == 0:
            print('Image', i)
        im = Image.open(prefix + row[0])
        images.append(im.crop((int(row[3]), int(row[4]), int(row[5]), int(row[6]))).resize((32,32)))
        labels.append(int(row[7]))  # the 8th column is the label
        arr.append(array(images[-1]))
        i = i+1
    gtFile.close()
    return arr, labels, images

def oneHotEncode(l, numClasses):

    onehot_encoded = list()
    for value in l:
        vector = [0 for _ in range(numClasses)]
        vector[value] = 1
        onehot_encoded.append(vector)

    return asarray(onehot_encoded)
